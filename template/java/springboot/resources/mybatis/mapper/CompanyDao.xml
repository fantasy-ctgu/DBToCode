<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ctgu.springbootbase.dao.CompanyDao">
	
	<resultMap type="com.ctgu.springbootbase.dto.CompanyDto" id="selectCompanyDtoResultMap">
		<result column="c_id" property="id" />
		<result column="c_username" property="username" />
		<result column="c_password" property="password" />
		<result column="c_company_name" property="companyName" />
		<result column="c_avatar" property="avatar" />
		<result column="c_province" property="province" />
		<result column="c_city" property="city" />
		<result column="c_address" property="address" />
		<result column="c_contacts" property="contacts" />
		<result column="c_phone" property="phone" />
		<result column="c_email" property="email" />
		<result column="c_introduce" property="introduce" />
		<result column="c_last_login" property="lastLogin" />
		<result column="c_last_ip" property="lastIp" />
		<result column="c_perfect" property="perfect" />
		<result column="c_updatetime" property="updatetime" />
		<result column="c_createtime" property="createtime" />
	    <collection property="positionss" ofType="com.ctgu.springbootbase.entity.Positions">
			<result column="p_id" property="id" />
			<result column="p_cid" property="cid" />
			<result column="p_title" property="title" />
			<result column="p_min_wages" property="minWages" />
			<result column="p_max_wages" property="maxWages" />
			<result column="p_province" property="province" />
			<result column="p_city" property="city" />
			<result column="p_seniority" property="seniority" />
			<result column="p_education" property="education" />
			<result column="p_requirement_num" property="requirementNum" />
			<result column="p_welfare" property="welfare" />
			<result column="p_positions_info" property="positionsInfo" />
			<result column="p_main_type_id" property="mainTypeId" />
			<result column="p_positions_name" property="positionsName" />
			<result column="p_keyword" property="keyword" />
			<result column="p_address" property="address" />
			<result column="p_positions_status_id" property="positionsStatusId" />
			<result column="p_createtime" property="createtime" />
		</collection>
	</resultMap>
	<sql id="companyDtoResultMapSql">
		c.id c_id,c.username c_username,c.password c_password,c.company_name c_company_name,c.avatar c_avatar,c.province c_province,c.city c_city,c.address c_address,c.contacts c_contacts,c.phone c_phone,c.email c_email,c.introduce c_introduce,c.last_login c_last_login,c.last_ip c_last_ip,c.perfect c_perfect,c.updatetime c_updatetime,c.createtime c_createtime,
		p.id p_id,p.cid p_cid,p.positions_name p_positions_name,p.min_wages p_min_wages,p.max_wages p_max_wages,p.province p_province,p.city p_city,p.seniority p_seniority,p.education p_education,p.requirement_num p_requirement_num,p.welfare p_welfare,p.positions_info p_positions_info,p.main_type_id p_main_type_id,p.keyword p_keyword,p.address p_address,p.positions_status_id p_positions_status_id,p.createtime p_createtime
  	</sql>

	<insert id="doInsert" parameterType="com.ctgu.springbootbase.entity.Company" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO company(username,password,company_name,contacts,phone) VALUES(#{username},#{password},#{companyName},#{contacts},#{phone})
	</insert>
	
	<delete id="doDelete" parameterType="com.ctgu.springbootbase.entity.Company">
		delete from company where id = #{id}
	</delete>
	
	<update id="doUpdate" parameterType="com.ctgu.springbootbase.entity.Company" useGeneratedKeys="true" keyProperty="id">
		UPDATE company 
		<set>
			<if test="password != null">
				password = #{password},
			</if>
			<if test="companyName != null">
				company_name = #{companyName},
			</if>
			<if test="avatar != null">
				avatar = #{avatar},
			</if>
			<if test="province != null">
				province = #{province},
			</if>
			<if test="city != null">
				city = #{city},
			</if>
			<if test="address != null">
				address = #{address},
			</if>
			<if test="contacts != null">
				contacts = #{contacts},
			</if>
			<if test="phone != null">
				phone = #{phone},
			</if>
			<if test="email != null">
				email = #{email},
			</if>
			<if test="introduce != null">
				introduce = #{introduce},
			</if>
			<if test="perfect != null">
				perfect = #{perfect},
			</if>
			<if test="lastLogin != null">
				last_login = #{lastLogin},
			</if>
			<if test="lastIp != null">
				last_ip = #{lastIp},
			</if>
			id = id
		</set>
		where id = #{id}
	</update>
	
	<select id="doSelect" parameterType="com.ctgu.springbootbase.entity.Company" resultType="com.ctgu.springbootbase.entity.Company">
		SELECT * FROM company
		<where>
			<if test="id != null">
				id = #{id}
			</if>
			<if test="username != null">
				and username = #{username}
			</if>
			<if test="password != null">
				and password = #{password}
			</if>
			<if test="password != null">
				and password = #{password}
			</if>
			<if test="companyName != null">
				and company_name like CONCAT('%',#{companyName},'%')
			</if>
			<if test="province != null">
				and province = #{province}
			</if>
			<if test="city != null">
				and city = #{city}
			</if>
			<if test="address != null">
				and address like CONCAT('%',#{address},'%')
			</if>
			<if test="contacts != null">
				and contacts like CONCAT('%',#{contacts},'%')
			</if>
			<if test="phone != null">
				and phone = #{phone}
			</if>
			<if test="email != null">
				and email = #{email}
			</if>
			<if test="introduce != null">
				and introduce like CONCAT('%',#{introduce},'%')
			</if>
			<if test="lastLogin != null">
				and last_login = #{lastLogin}
			</if>
			<if test="lastIp != null">
				and last_ip = #{lastIp}
			</if>
		</where>
	</select>
	
	<select id="doSelectCount" parameterType="com.ctgu.springbootbase.entity.Company" resultType="int">
		SELECT COUNT(*) FROM company
		<where>
			<if test="id != null">
				id = #{id}
			</if>
			<if test="username != null">
				and username = #{username}
			</if>
			<if test="password != null">
				and password = #{password}
			</if>
			<if test="password != null">
				and password = #{password}
			</if>
			<if test="companyName != null">
				and company_name like CONCAT('%',#{companyName},'%')
			</if>
			<if test="province != null">
				and province = #{province}
			</if>
			<if test="city != null">
				and city = #{city}
			</if>
			<if test="address != null">
				and address like CONCAT('%',#{address},'%')
			</if>
			<if test="contacts != null">
				and contacts like CONCAT('%',#{contacts},'%')
			</if>
			<if test="phone != null">
				and phone = #{phone}
			</if>
			<if test="email != null">
				and email = #{email}
			</if>
			<if test="introduce != null">
				and introduce like CONCAT('%',#{introduce},'%')
			</if>
			<if test="lastLogin != null">
				and last_login = #{lastLogin}
			</if>
			<if test="lastIp != null">
				and last_ip = #{lastIp}
			</if>
		</where>
	</select>
	
	<select id="selectDtoBySome" parameterType="com.ctgu.springbootbase.entity.Company" resultMap="selectCompanyDtoResultMap">
		SELECT 
		<include refid="companyDtoResultMapSql" />
 		FROM company c LEFT JOIN positions p ON c.id = p.cid
		<where>
			<if test="id != null">
				c.id = #{id}
			</if>
			<if test="username != null">
				and c.username = #{username}
			</if>
			<if test="password != null">
				and password = #{password}
			</if>
			<if test="companyName != null">
				and c.company_name like CONCAT('%',#{companyName},'%')
			</if>
			<if test="province != null">
				and c.province = #{province}
			</if>
			<if test="city != null">
				and c.city = #{city}
			</if>
			<if test="address != null">
				and c.address like CONCAT('%',#{address},'%')
			</if>
			<if test="contacts != null">
				and c.contacts like CONCAT('%',#{contacts},'%')
			</if>
			<if test="phone != null">
				and c.phone = #{phone}
			</if>
			<if test="email != null">
				and c.email = #{email}
			</if>
			<if test="introduce != null">
				and c.introduce like CONCAT('%',#{introduce},'%')
			</if>
			<if test="lastLogin != null">
				and c.last_login = #{lastLogin}
			</if>
			<if test="lastIp != null">
				and c.last_ip = #{lastIp}
			</if>
		</where>
	</select>
	
</mapper>
